#!/usr/bin/python
#

from hashlib import md5
from base64 import b64decode

infile = 'malware_stage2.enc'
outfile = 'malware_stage2.dll'

password = 'XNNftGMPPG'

enc = open(infile, 'rb').read()
key = md5(password.encode()).digest()

out = b''
i = 0
for c in enc:
    out += bytes([(c ^ key[i])])
    i = (i + 1) % len(password)

open(outfile, 'wb').write(b64decode(out.decode()))

print("[*] malware stage2 has been decrypted to {}".format(outfile))
